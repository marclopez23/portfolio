---
// src/pages/index.astro
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import PageLayout from "../../layouts/PageLayout.astro";
import Button from "../../components/Button.astro";
import ProjectThumbnail from "../../components/ProjectThumbnail.astro";

// Import solo para la imagen crítica del hero
import profilePhoto from "../../assets/photo-profile.png";

// Obtener proyectos destacados de /en/
const featuredProjects = await getCollection("projects", ({ id, data }) => {
  return id.startsWith('en/') && data.featured === true && data.protected !== true;
});
// Ordenar por orden y tomar solo los primeros 3
const projectsToShow = featuredProjects
  .sort((a, b) => (a.data.order || 0) - (b.data.order || 0))
  .slice(0, 3);

function getUrl(path: string): string {
  if (!path) return '#';
  const base = import.meta.env.BASE_URL;
  const cleanPath = path.startsWith('/') ? path.slice(1) : path;
  const baseWithSlash = base.endsWith('/') ? base : base + '/';
  return `${baseWithSlash}${cleanPath}`;
}
---

<PageLayout title="Marc López - Product & System Designer" currentPage="/" lang="en">
  <div class="home-page">
    <!-- Hero Section -->
    <section class="hero" id="hero" aria-labelledby="hero-title">
      <div class="container">
        <div class="hero__content">
          <!-- Foto perfil - Optimizada con Astro Image -->
          <div class="hero__image">
            <div class="hero__image-container">
              <Image
                src={profilePhoto}
                alt="Profile image of Marc López, Product & System Designer"
                class="hero__photo"
                width={425}
                height={451}
                loading="eager"
                format="webp"
                quality={90}
                densities={[1, 2]}
              />
            </div>
          </div>

          <!-- Contenido texto -->
          <div class="hero__text">
            <div class="hero__intro">
              <p class="hero__subtitle">
                Marc López, Product & System Designer
              </p>
              <h1 class="hero__title" id="hero-title">
                Transforming complex ideas into simple, memorable experiences<span
                  class="accent-dot">.</span
                >
              </h1>
              <p class="hero__description">
                I design scalable products that solve real problems, bridging user needs with business goals to create experiences that truly work<span
                  class="accent-dot">.</span
                >
              </p>
            </div>
            <div class="hero__actions">
              <Button
                text="Who I am"
                href={getUrl('en/about')}
                as="a"
                class="hero__cta"
              />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Proyectos Section -->
    <section
      class="section section--with-border"
      id="proyectos"
      aria-labelledby="projects-title"
    >
      <div class="container">
        <div class="projects__content">
          <!-- Title sidebar -->
          <div class="projects__sidebar">
  <div class="projects__sticky-container">
    <h2 class="section-title" id="projects-title">
      Projects<span class="accent-dot">.</span>
    </h2>
  </div>
</div>

          <!-- Projects grid - Dinámico desde content collections -->
          <div class="projects__grid">
            {
              projectsToShow.map((project) => (
                <ProjectThumbnail
                  title={project.data.title}
                  imageSrc={getUrl(project.data.heroImage)}
                  imageAlt={`Preview of the project ${project.data.title}`}
                  href={getUrl(`en/projects/${project.slug.replace('en/', '')}`)}
                  linkText="View project"
                  variant="big"
                  loading="lazy"
                  class="project-card"
                />
              ))
            }

            <!-- Ver todos button -->
            <div class="projects__all-button">
              <Button
                text="View all projects"
                href={getUrl('en/projects')}
                as="a"
                class="projects__cta"
              />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contacto Section -->
    <section
      class="section section--with-border"
      id="contacto"
      aria-labelledby="contact-title"
    >
      <div class="container">
        <div class="contact__content">
          <!-- Title sidebar -->
          <div class="contact__sidebar">
            <h2 class="section-title" id="contact-title">
              Contact<span class="accent-dot">.</span>
            </h2>
          </div>

          <!-- Contact links -->
          <div class="contact__links">
            <a
              href="https://www.linkedin.com/in/marc-lopez-pujol/"
              target="_blank"
              rel="noopener noreferrer"
              class="contact__link"
            >
              <div class="contact__icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="50"
                  height="51"
                  viewBox="0 0 50 51"
                  fill="none"
                >
                  <g clip-path="url(#clip0_333_1981)">
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M5.55556 50.5H44.4444C47.5127 50.5 50 48.0127 50 44.9444V6.05556C50 2.98731 47.5127 0.5 44.4444 0.5H5.55556C2.48731 0.5 0 2.98731 0 6.05556V44.9444C0 48.0127 2.48731 50.5 5.55556 50.5Z"
                      fill="#212121"></path>
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M43.0554 43.5554H35.6357V30.918C35.6357 27.4532 34.3192 25.5169 31.5768 25.5169C28.5934 25.5169 27.0347 27.5319 27.0347 30.918V43.5554H19.8842V19.4814H27.0347V22.7241C27.0347 22.7241 29.1846 18.7459 34.2933 18.7459C39.3997 18.7459 43.0554 21.8641 43.0554 28.3132V43.5554ZM11.3536 16.3291C8.91799 16.3291 6.94434 14.3399 6.94434 11.8867C6.94434 9.43347 8.91799 7.44434 11.3536 7.44434C13.7892 7.44434 15.7617 9.43347 15.7617 11.8867C15.7617 14.3399 13.7892 16.3291 11.3536 16.3291ZM7.66139 43.5554H15.1175V19.4814H7.66139V43.5554Z"
                      fill="#A09F9F"></path>
                  </g>
                  <defs>
                    <clipPath id="clip0_333_1981">
                      <rect
                        width="50"
                        height="50"
                        fill="white"
                        transform="translate(0 0.5)"></rect>
                    </clipPath>
                  </defs>
                </svg>
              </div>
              <span class="contact__text">Marc López</span>
            </a>

            <a href="mailto:marclopez23496@gmail.com" class="contact__link">
              <div class="contact__icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="50"
                  height="51"
                  viewBox="0 0 50 51"
                  fill="none"
                >
                  <g clip-path="url(#clip0_333_1987)">
                    <path
                      d="M11.5186 0.583008H38.4813C44.8166 0.583008 49.9169 5.68324 49.9169 12.0185V38.9813C49.9169 45.3166 44.8166 50.4169 38.4813 50.4169H11.5186C5.18327 50.4169 0.0830078 45.3166 0.0830078 38.9813V12.0185C0.0830078 5.68324 5.18327 0.583008 11.5186 0.583008Z"
                      fill="#212121"></path>
                    <path
                      d="M11.0014 14.7549C10.7388 14.7549 10.4915 14.8002 10.2574 14.8933L14.9466 19.721L19.6877 24.6351L19.7742 24.739L19.9127 24.8774L20.0511 25.0158L20.3279 25.31L24.3943 29.4801C24.462 29.5222 24.6582 29.7039 24.8114 29.7805C25.0089 29.8792 25.2229 29.9702 25.4435 29.9781C25.6815 29.9866 25.9249 29.9184 26.1391 29.8142C26.2995 29.7362 26.3708 29.6243 26.5572 29.4801L31.2637 24.6178L36.0222 19.721L40.6076 14.9971C40.3132 14.8376 39.9872 14.7549 39.6386 14.7549H11.0014ZM9.56521 15.3432C9.06515 15.817 8.75195 16.5293 8.75195 17.3331V33.183C8.75195 33.8338 8.96098 34.425 9.30566 34.8788L9.96319 34.2558L14.8601 29.4974L19.2032 25.2927L19.1167 25.1889L14.3583 20.292L9.59982 15.3778L9.56521 15.3432ZM41.2305 15.4989L36.5932 20.292L31.852 25.1889L31.7655 25.2754L36.2817 29.6531L41.1786 34.4116L41.4727 34.6884C41.7364 34.2654 41.888 33.7443 41.888 33.183V17.3331C41.888 16.6164 41.6397 15.9666 41.2305 15.4989ZM19.7569 25.8637L15.4311 30.0684L10.5169 34.8269L9.89398 35.4325C10.2224 35.644 10.5961 35.7786 11.0014 35.7786H39.6386C40.1258 35.7786 40.5678 35.5911 40.9363 35.2941L40.6249 34.9826L35.7107 30.2242L31.1945 25.8637L27.1282 30.0511C26.9081 30.197 26.7611 30.3588 26.5462 30.4582C26.2003 30.6182 25.8213 30.7534 25.4403 30.7476C25.0582 30.7417 24.6837 30.5923 24.3408 30.4236C24.1687 30.339 24.077 30.2548 23.8752 30.0857L19.7569 25.8637Z"
                      fill="#A09F9F"></path>
                  </g>
                  <defs>
                    <clipPath id="clip0_333_1987">
                      <rect
                        width="50"
                        height="50"
                        fill="white"
                        transform="translate(0 0.5)"></rect>
                    </clipPath>
                  </defs>
                </svg>
              </div>
              <span class="contact__text">marclopez23496@gmail.com</span>
            </a>
          </div>
        </div>
      </div>
    </section>
  </div>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const stickyContainer = document.querySelector('.projects__sticky-container');
    const projectsSection = document.getElementById('proyectos');
    
    if (stickyContainer && projectsSection && window.innerWidth > 1200) {
      // Observer para detectar cuando la sección está visible
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            stickyContainer.classList.remove('is-sticky');
          } else {
            const rect = entry.boundingClientRect;
            if (rect.bottom > 0) {
              // La sección aún es visible por abajo
              stickyContainer.classList.add('is-sticky');
            } else {
              // La sección ya no es visible
              stickyContainer.classList.remove('is-sticky');
            }
          }
        });
      }, {
        rootMargin: '-120px 0px 0px 0px', // Offset por el header
        threshold: [0, 1]
      });

      observer.observe(projectsSection);

      // Cleanup en resize
      window.addEventListener('resize', () => {
        if (window.innerWidth <= 1200) {
          observer.disconnect();
          stickyContainer.classList.remove('is-sticky');
        }
      });
    }

    // Smooth scroll para enlaces internos (fix TypeScript)
    document.querySelectorAll<HTMLAnchorElement>('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const href = this.getAttribute('href');
        if (!href) return;
        
        const targetId = href.substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const headerHeight = 120; // Ajustar según tu header
          const elementPosition = targetElement.offsetTop - headerHeight;
          
          window.scrollTo({
            top: elementPosition,
            behavior: 'smooth'
          });
        }
      });
    });
  });
</script>
</PageLayout>

<style>
  @import "../../styles/layout.css";
  /* ========================================
     HOME PAGE STYLES
     ======================================== */

  .home-page {
    background-color: var(--color-main-bg);
    color: var(--color-text-primary);
  }

  .container {
    max-width: 1512px;
    margin: 0 auto;
  }

  /* Accent dot styling */
  .accent-dot {
    color: var(--color-text-tertiary);
  }

  /* ========================================
     HERO SECTION
     ======================================== */

  .hero {
    padding: var(--spacing-xhg) var(--section-horizontal);
    min-height: 50dvh;
    display: flex;
    align-items: center;
  }

  .hero__content {
    display: flex;
    gap: var(--spacing-hg);
    align-items: center;
    width: 100%;
  }

  /* Hero Image */
  .hero__image {
    flex-shrink: 0;
    width: 425px;
    height: 451px;
    position: relative;
  }

  .hero__image-container {
    width: 100%;
    height: 100%;
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: linear-gradient(135deg, #3f3f3f 0%, #2a2a2a 100%);
  }

  .hero__photo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Hero Text */
  .hero__text {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2xl);
  }

  .hero__subtitle {
    font-family: var(--font-family-primary);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-tertiary);
    margin: 0 0 var(--spacing-lg) 0;
    line-height: var(--line-height-normal);
  }

  .hero__title {
    font-family: var(--font-family-primary);
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    margin: 0 0 var(--spacing-lg) 0;
    line-height: var(--line-height-normal);
    max-width: 975px;
  }

  .hero__description {
    font-family: var(--font-family-primary);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-regular);
    color: var(--color-text-secondary);
    margin: 0;
    line-height: var(--line-height-normal);
    max-width: 975px;
  }

  /* ========================================
     PROJECTS SECTION
     ======================================== */

  .projects {
    border-top: 1px solid var(--color-divider);
    padding: var(--spacing-xl) 0;
  }

  .projects__content {
    display: flex;
    gap: var(--section-gap);
    align-items: flex-start;
  }

  .projects__sidebar {
    flex-shrink: 0;
    width: 418px;
    padding-right: var(--spacing-2xl);
    border-right: 2px solid var(--color-divider);
    position: sticky;
    top: 170px;
  }

  .section-title {
    font-family: var(--font-family-primary);
    font-size: var(--font-size-hg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin: 0;
    line-height: 1.25;
  }

  .projects__grid {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-hg);
  }

  .projects__all-button {
    display: flex;
    justify-content: center;
    width: 100%;
    padding-top: var(--spacing-lg);
  }

  /* ========================================
     CONTACT SECTION
     ======================================== */

  .contact {
    border-top: 1px solid var(--color-divider);
    padding: var(--spacing-xl) 0;
  }

  .contact__content {
    display: flex;
    gap: var(--section-gap);
    align-items: center;
  }

  .contact__sidebar {
    flex-shrink: 0;
    width: 418px;
    padding-right: var(--spacing-2xl);
    border-right: 2px solid var(--color-divider);
  }

  .contact__links {
    flex: 1;
    display: flex;
    gap: var(--spacing-2xl);
  }

  .contact__link {
    flex: 1;
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    padding: var(--spacing-xl);
    background-color: var(--color-surface);
    border-radius: var(--radius-xl);
    text-decoration: none;
    color: var(--color-text-tertiary);
    transition: all 0.2s ease-in-out;
  }

  .contact__link:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .contact__link:focus-visible {
    outline: 3px solid var(--color-text-tertiary);
    outline-offset: 2px;
  }

  .contact__icon {
    flex-shrink: 0;
  }

  .contact__text {
    font-family: var(--font-family-primary);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    line-height: var(--line-height-normal);
  }

  /* ========================================
     RESPONSIVE DESIGN
     ======================================== */

  /* Tablet */
  @media (max-width: 1200px) {

    .hero{
      padding: var(--section-vertical) var(--section-horizontal);
    }

    .hero__content {
      flex-direction: column;
      gap: var(--spacing-2xl);
      align-items: flex-start;
    }

    .hero__image {
      width: 350px;
      height: 370px;
    }

    .projects__content,
    .contact__content {
      flex-direction: column;
      gap: var(--section-gap);
    }

    .projects__sidebar,
    .contact__sidebar {
      width: 100%;
      border-right: none;
      border-bottom: none;
      padding-right: 0;
      padding-bottom: none;
      position: unset;
    }

    .contact__links {
      flex-direction: column;
      width: 100%;
    }
  }

   /* ========================================
     ENHANCED STICKY BEHAVIOR
     ======================================== */

  /* Mejora el comportamiento sticky para desktop */
  @media (min-width: 1201px) {
    .projects__sticky-container {
      position: sticky;
      top: 120px; /* Ajustar según altura de tu header */
      z-index: 10;
      background-color: var(--color-main-bg);
      padding: var(--spacing-md) 0;
      transition: all 0.2s ease-in-out;
    }

    /* Línea superior cuando está sticky */
    .projects__sticky-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: -var(--spacing-2xl);
      right: 0;
      height: 1px;
      background-color: transparent;
      transition: background-color 0.2s ease-in-out;
    }

    .projects__sticky-container.is-sticky::before {
      background-color: var(--color-divider);
    }
  }

  /* En responsive mantener comportamiento normal */
  @media (max-width: 1200px) {
    .projects__sticky-container {
      position: relative;
      top: auto;
      padding: 0;
    }
  }

  /* Mobile */
  @media (max-width: 767px) {
    .hero {
      padding: var(--section-vertical) var(--section-horizontal);
      min-height: auto;
    }

    .hero__content {
      gap: var(--section-gap);
    }

    .hero__subtitle{
      font-size: var(--font-size-2xl);
    }

    .hero__image {
      width: 100%;
      max-width: 382px;
      height: 405px;
    }

    .hero__title {
      font-size: var(--font-size-3xl);
    }

    .hero__description {
      font-size: var(--font-size-xl);
    }

    .section-title {
      font-size: var(--font-size-hg);
    }

    .contact__text {
      font-size: var(--font-size-xl);
    }

    .projects__grid {
      gap: var(--spacing-2xl);
    }
  }

  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    .contact__link {
      transition: none;
    }

    .contact__link:hover {
      transform: none;
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .hero__image-container {
      border: 2px solid var(--color-text-primary);
    }

    .contact__link {
      border: 2px solid var(--color-text-tertiary);
    }
  }
</style>
